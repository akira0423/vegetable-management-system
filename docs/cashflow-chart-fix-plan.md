# 月次キャッシュフローチャート改善計画

## 現状の問題

### データ構造
- **2025年9月**: watering - 10億円の支出
- **2025年12月**: watering - 1000億円の支出
- 両方とも収入なし、純粋な支出

### 表示上の問題
1. **スケール問題**: 1000億円という極端な値により、他の小さな値が見えなくなる
2. **ネット表示**: 収支を相殺して表示するため、詳細が不明瞭

## 改善案

### 案1: 収入・支出の分離表示（実装済み）
```javascript
// 収入用の棒グラフ
datasets.push({
  label: `${workType} (収入)`,
  data: incomeData,
  stack: 'income'
})

// 支出用の棒グラフ
datasets.push({
  label: `${workType} (支出)`,
  data: expenseData,
  stack: 'expense'
})
```

### 案2: 対数スケールの導入
```javascript
scales: {
  y: {
    type: 'logarithmic',
    ticks: {
      callback: function(value) {
        // 見やすい表記に変換
      }
    }
  }
}
```

### 案3: 異常値の別扱い
```javascript
// 100億円以上は別のデータセットとして表示
if (Math.abs(expense) > 10000000000) {
  specialDatasets.push({
    label: '特別支出',
    data: [expense],
    backgroundColor: 'red'
  })
}
```

### 案4: ツールチップでの詳細表示
- グラフ上では簡略表示
- ホバー時に正確な金額を表示

## 推奨される解決策

**収入・支出の分離表示（案1）+ 金額の視覚的調整**

1. 収入と支出を別々の棒グラフとして表示
2. 極端に大きな値には特別な視覚効果を適用
3. Y軸に億円・兆円単位の表記を使用
4. ツールチップで正確な金額を表示

## テスト方法

1. ブラウザのコンソールでデバッグログを確認
2. 2025年12月のデータが表示されているか確認
3. Y軸の範囲が適切か確認
4. ツールチップで正確な金額が見えるか確認