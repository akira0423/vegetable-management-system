 -- 1.1 全テーブルのカラム構造確認
 | table_name                 | column_name                 | data_type                | is_nullable | column_default               | key_type              |
| -------------------------- | --------------------------- | ------------------------ | ----------- | ---------------------------- | --------------------- |
| accounting_items           | id                          | uuid                     | NO          | gen_random_uuid()            | PK                    |
| accounting_items           | code                        | character varying        | NO          | null                         |                       |
| accounting_items           | name                        | character varying        | NO          | null                         |                       |
| accounting_items           | type                        | character varying        | NO          | null                         |                       |
| accounting_items           | category                    | character varying        | YES         | null                         |                       |
| accounting_items           | description                 | text                     | YES         | null                         |                       |
| accounting_items           | is_active                   | boolean                  | YES         | true                         |                       |
| accounting_items           | sort_order                  | integer                  | YES         | 0                            |                       |
| accounting_items           | created_at                  | timestamp with time zone | YES         | now()                        |                       |
| accounting_items           | updated_at                  | timestamp with time zone | YES         | now()                        |                       |
| accounting_items           | cost_type                   | text                     | YES         | null                         |                       |
| accounting_recommendations | id                          | uuid                     | NO          | gen_random_uuid()            | PK                    |
| accounting_recommendations | company_id                  | uuid                     | YES         | null                         | FK → companies        |
| accounting_recommendations | work_type                   | character varying        | NO          | null                         |                       |
| accounting_recommendations | accounting_item_id          | uuid                     | YES         | null                         | FK → accounting_items |
| accounting_recommendations | confidence_score            | numeric                  | YES         | null                         |                       |
| accounting_recommendations | usage_count                 | integer                  | YES         | 1                            |                       |
| accounting_recommendations | avg_amount                  | numeric                  | YES         | null                         |                       |
| accounting_recommendations | last_used_at                | timestamp with time zone | YES         | now()                        |                       |
| accounting_recommendations | created_at                  | timestamp with time zone | YES         | now()                        |                       |
| accounting_recommendations | updated_at                  | timestamp with time zone | YES         | now()                        |                       |
| companies                  | id                          | uuid                     | NO          | gen_random_uuid()            | PK                    |
| companies                  | name                        | text                     | NO          | null                         |                       |
| companies                  | contact_email               | text                     | NO          | null                         |                       |
| companies                  | phone                       | text                     | YES         | null                         |                       |
| companies                  | address                     | text                     | YES         | null                         |                       |
| companies                  | is_active                   | boolean                  | NO          | true                         |                       |
| companies                  | settings                    | jsonb                    | YES         | '{}'::jsonb                  |                       |
| companies                  | created_at                  | timestamp with time zone | NO          | now()                        |                       |
| companies                  | updated_at                  | timestamp with time zone | NO          | now()                        |                       |
| users                      | id                          | uuid                     | NO          | null                         | PK                    |
| users                      | instance_id                 | uuid                     | YES         | null                         |                       |
| users                      | id                          | uuid                     | NO          | null                         | PK                    |
| users                      | id                          | uuid                     | NO          | null                         | PK                    |
| users                      | id                          | uuid                     | NO          | null                         | PK                    |
| users                      | id                          | uuid                     | NO          | null                         | PK                    |
| users                      | company_id                  | uuid                     | NO          | null                         | FK → companies        |
| users                      | id                          | uuid                     | NO          | null                         | PK                    |
| users                      | id                          | uuid                     | NO          | null                         | PK                    |
| users                      | id                          | uuid                     | NO          | null                         | PK                    |
| users                      | email                       | text                     | NO          | null                         |                       |
| users                      | aud                         | character varying        | YES         | null                         |                       |
| users                      | role                        | character varying        | YES         | null                         |                       |
| users                      | full_name                   | text                     | YES         | null                         |                       |
| users                      | is_active                   | boolean                  | NO          | true                         |                       |
| users                      | email                       | character varying        | YES         | null                         |                       |
| users                      | last_login_at               | timestamp with time zone | YES         | null                         |                       |
| users                      | encrypted_password          | character varying        | YES         | null                         |                       |
| users                      | email_confirmed_at          | timestamp with time zone | YES         | null                         |                       |
| users                      | settings                    | jsonb                    | YES         | '{}'::jsonb                  |                       |
| users                      | invited_at                  | timestamp with time zone | YES         | null                         |                       |
| users                      | created_at                  | timestamp with time zone | NO          | now()                        |                       |
| users                      | confirmation_token          | character varying        | YES         | null                         |                       |
| users                      | updated_at                  | timestamp with time zone | NO          | now()                        |                       |
| users                      | confirmation_sent_at        | timestamp with time zone | YES         | null                         |                       |
| users                      | recovery_token              | character varying        | YES         | null                         |                       |
| users                      | recovery_sent_at            | timestamp with time zone | YES         | null                         |                       |
| users                      | email_change_token_new      | character varying        | YES         | null                         |                       |
| users                      | email_change                | character varying        | YES         | null                         |                       |
| users                      | email_change_sent_at        | timestamp with time zone | YES         | null                         |                       |
| users                      | last_sign_in_at             | timestamp with time zone | YES         | null                         |                       |
| users                      | raw_app_meta_data           | jsonb                    | YES         | null                         |                       |
| users                      | raw_user_meta_data          | jsonb                    | YES         | null                         |                       |
| users                      | is_super_admin              | boolean                  | YES         | null                         |                       |
| users                      | created_at                  | timestamp with time zone | YES         | null                         |                       |
| users                      | updated_at                  | timestamp with time zone | YES         | null                         |                       |
| users                      | phone                       | text                     | YES         | NULL::character varying      |                       |
| users                      | phone_confirmed_at          | timestamp with time zone | YES         | null                         |                       |
| users                      | phone_change                | text                     | YES         | ''::character varying        |                       |
| users                      | phone_change_token          | character varying        | YES         | ''::character varying        |                       |
| users                      | phone_change_sent_at        | timestamp with time zone | YES         | null                         |                       |
| users                      | confirmed_at                | timestamp with time zone | YES         | null                         |                       |
| users                      | email_change_token_current  | character varying        | YES         | ''::character varying        |                       |
| users                      | email_change_confirm_status | smallint                 | YES         | 0                            |                       |
| users                      | banned_until                | timestamp with time zone | YES         | null                         |                       |
| users                      | reauthentication_token      | character varying        | YES         | ''::character varying        |                       |
| users                      | reauthentication_sent_at    | timestamp with time zone | YES         | null                         |                       |
| users                      | is_sso_user                 | boolean                  | NO          | false                        |                       |
| users                      | deleted_at                  | timestamp with time zone | YES         | null                         |                       |
| users                      | is_anonymous                | boolean                  | NO          | false                        |                       |
| vegetables                 | id                          | uuid                     | NO          | gen_random_uuid()            | PK                    |
| vegetables                 | company_id                  | uuid                     | NO          | null                         | FK → companies        |
| vegetables                 | name                        | text                     | NO          | null                         |                       |
| vegetables                 | variety_name                | text                     | YES         | null                         |                       |
| vegetables                 | plot_name                   | text                     | YES         | null                         |                       |
| vegetables                 | area_size                   | numeric                  | YES         | null                         |                       |
| vegetables                 | plant_count                 | integer                  | YES         | null                         |                       |
| vegetables                 | planting_date               | date                     | NO          | null                         |                       |
| vegetables                 | expected_harvest_start      | date                     | YES         | null                         |                       |
| vegetables                 | expected_harvest_end        | date                     | YES         | null                         |                       |
| vegetables                 | actual_harvest_start        | date                     | YES         | null                         |                       |
| vegetables                 | actual_harvest_end          | date                     | YES         | null                         |                       |
| vegetables                 | status                      | text                     | NO          | 'planning'::text             |                       |
| vegetables                 | notes                       | text                     | YES         | null                         |                       |
| vegetables                 | deleted_at                  | timestamp with time zone | YES         | null                         |                       |
| vegetables                 | created_by                  | uuid                     | YES         | null                         | FK → users            |
| vegetables                 | created_at                  | timestamp with time zone | NO          | now()                        |                       |
| vegetables                 | updated_at                  | timestamp with time zone | NO          | now()                        |                       |
| vegetables                 | spatial_data                | jsonb                    | YES         | null                         |                       |
| vegetables                 | polygon_coordinates         | jsonb                    | YES         | null                         |                       |
| vegetables                 | plot_center_lat             | numeric                  | YES         | null                         |                       |
| vegetables                 | plot_center_lng             | numeric                  | YES         | null                         |                       |
| vegetables                 | polygon_color               | character varying        | YES         | '#22c55e'::character varying |                       |
| work_report_accounting     | id                          | uuid                     | NO          | gen_random_uuid()            | PK                    |
| work_report_accounting     | work_report_id              | uuid                     | YES         | null                         | FK → work_reports     |
| work_report_accounting     | accounting_item_id          | uuid                     | YES         | null                         | FK → accounting_items |
| work_report_accounting     | amount                      | numeric                  | NO          | 0                            |                       |
| work_report_accounting     | custom_item_name            | character varying        | YES         | null                         |                       |
| work_report_accounting     | notes                       | text                     | YES         | null                         |                       |
| work_report_accounting     | is_ai_recommended           | boolean                  | YES         | false                        |                       |
| work_report_accounting     | created_at                  | timestamp with time zone | YES         | now()                        |                       |
| work_report_accounting     | updated_at                  | timestamp with time zone | YES         | now()                        |                       |
| work_reports               | id                          | uuid                     | NO          | gen_random_uuid()            | PK                    |
| work_reports               | company_id                  | uuid                     | NO          | null                         | FK → companies        |
| work_reports               | vegetable_id                | uuid                     | NO          | null                         | FK → vegetables       |
| work_reports               | growing_task_id             | uuid                     | YES         | null                         | FK → growing_tasks    |
| work_reports               | work_type                   | text                     | NO          | null                         |                       |
| work_reports               | description                 | text                     | YES         | null                         |                       |
| work_reports               | work_date                   | date                     | NO          | null                         |                       |
| work_reports               | start_time                  | time without time zone   | YES         | null                         |                       |
| work_reports               | end_time                    | time without time zone   | YES         | null                         |                       |
| work_reports               | duration_hours              | numeric                  | YES         | null                         |                       |
| work_reports               | weather                     | text                     | YES         | null                         |                       |
| work_reports               | temperature                 | numeric                  | YES         | null                         |                       |
| work_reports               | harvest_amount              | numeric                  | YES         | null                         |                       |
| work_reports               | harvest_unit                | text                     | YES         | null                         |                       |
| work_reports               | harvest_quality             | text                     | YES         | null                         |                       |
| work_reports               | worker_count                | integer                  | YES         | 1                            |                       |
| work_reports               | notes                       | text                     | YES         | null                         |                       |
| work_reports               | deleted_at                  | timestamp with time zone | YES         | null                         |                       |
| work_reports               | created_by                  | uuid                     | YES         | null                         | FK → users            |
| work_reports               | created_at                  | timestamp with time zone | NO          | now()                        |                       |
| work_reports               | updated_at                  | timestamp with time zone | NO          | now()                        |                       |
| work_reports               | expected_price              | numeric                  | YES         | null                         |                       |
| work_reports               | humidity                    | integer                  | YES         | null                         |                       |
| work_reports               | soil_ph                     | numeric                  | YES         | null                         |                       |
| work_reports               | soil_ec                     | numeric                  | YES         | null                         |                       |
| work_reports               | phosphorus_absorption       | integer                  | YES         | null                         |                       |
| work_reports               | cec                         | numeric                  | YES         | null                         |                       |
| work_reports               | exchangeable_calcium        | integer                  | YES         | null                         |                       |
| work_reports               | exchangeable_magnesium      | integer                  | YES         | null                         |                       |
| work_reports               | exchangeable_potassium      | integer                  | YES         | null                         |                       |
| work_reports               | base_saturation             | numeric                  | YES         | null                         |                       |
| work_reports               | calcium_magnesium_ratio     | numeric                  | YES         | null                         |                       |
| work_reports               | magnesium_potassium_ratio   | numeric                  | YES         | null                         |                       |
| work_reports               | available_phosphorus        | numeric                  | YES         | null                         |                       |
| work_reports               | available_silica            | numeric                  | YES         | null                         |                       |
| work_reports               | humus_content               | numeric                  | YES         | null                         |                       |
| work_reports               | ammonium_nitrogen           | numeric                  | YES         | null                         |                       |
| work_reports               | nitrate_nitrogen            | numeric                  | YES         | null                         |                       |
| work_reports               | manganese                   | numeric                  | YES         | null                         |                       |
| work_reports               | boron                       | numeric                  | YES         | null                         |                       |
| work_reports               | free_iron_oxide             | numeric                  | YES         | null                         |                       |
| work_reports               | soil_notes                  | text                     | YES         | null                         |                       |
| work_reports               | work_duration               | integer                  | YES         | null                         |                       |
| work_reports               | photos                      | ARRAY                    | YES         | null                         |                       |
| work_reports               | income_items                | jsonb                    | YES         | null                         |                       |
| work_reports               | expense_items               | jsonb                    | YES         | null                         |                       |
| work_reports               | income_total                | numeric                  | YES         | null                         |                       |
| work_reports               | expense_total               | numeric                  | YES         | null                         |                       |
| work_reports               | net_income                  | numeric                  | YES         | null                         |                       |
| work_reports               | work_amount                 | numeric                  | YES         | null                         |                       |
| work_reports               | work_unit                   | text                     | YES         | null                         |                       |
| work_reports               | fertilizer_type             | text                     | YES         | null                         |                       |
| work_reports               | fertilizer_amount           | numeric                  | YES         | null                         |                       |
| work_reports               | fertilizer_unit             | text                     | YES         | null                         |                       |
| work_reports               | expected_revenue            | numeric                  | YES         | null                         |                       |

===========================================================
  2. インデックス構造の確認

-- 2.1 既存インデックスの詳細
「ERROR:  42702: column reference "schemaname" is ambiguous
LINE 3:       schemaname,」 エラーなのでもう一度SQL示してください。

 -- 2.2 インデックスの使用頻度
 | schemaname | tablename              | attname                   | n_distinct | correlation | null_frac | avg_width |
| ---------- | ---------------------- | ------------------------- | ---------- | ----------- | --------- | --------- |
| public     | accounting_items       | category                  | -0.666667  | -0.650435   | 0         | 14        |
| public     | accounting_items       | code                      | -1         | -0.00347826 | 0         | 4         |
| public     | accounting_items       | cost_type                 | -0.125     | 0.0474308   | 0.0416667 | 11        |
| public     | accounting_items       | created_at                | 1          | 1           | 0         | 8         |
| public     | accounting_items       | description               | 0          | null        | 1         | 0         |
| public     | accounting_items       | id                        | -1         | -0.188696   | 0         | 16        |
| public     | accounting_items       | is_active                 | 1          | 1           | 0         | 1         |
| public     | accounting_items       | name                      | -1         | -0.326957   | 0         | 14        |
| public     | accounting_items       | sort_order                | -1         | 1           | 0         | 4         |
| public     | accounting_items       | type                      | -0.125     | 0.16        | 0         | 7         |
| public     | accounting_items       | updated_at                | 1          | 1           | 0         | 8         |
| public     | work_report_accounting | accounting_item_id        | -0.363636  | 0.172727    | 0         | 16        |
| public     | work_report_accounting | amount                    | -0.818182  | 0.309091    | 0         | 5         |
| public     | work_report_accounting | created_at                | -0.909091  | 1           | 0         | 8         |
| public     | work_report_accounting | custom_item_name          | -0.0909091 | null        | 0.909091  | 13        |
| public     | work_report_accounting | id                        | -1         | -0.109091   | 0         | 16        |
| public     | work_report_accounting | is_ai_recommended         | -0.181818  | 0.863636    | 0         | 1         |
| public     | work_report_accounting | notes                     | -0.0909091 | null        | 0.909091  | 31        |
| public     | work_report_accounting | updated_at                | -0.909091  | 1           | 0         | 8         |
| public     | work_report_accounting | work_report_id            | -0.909091  | -0.490909   | 0         | 16        |
| public     | work_reports           | ammonium_nitrogen         | 0          | null        | 1         | 0         |
| public     | work_reports           | available_phosphorus      | 0          | null        | 1         | 0         |
| public     | work_reports           | available_silica          | 0          | null        | 1         | 0         |
| public     | work_reports           | base_saturation           | 0          | null        | 1         | 0         |
| public     | work_reports           | boron                     | 0          | null        | 1         | 0         |
| public     | work_reports           | calcium_magnesium_ratio   | 0          | null        | 1         | 0         |
| public     | work_reports           | cec                       | 0          | null        | 1         | 0         |
| public     | work_reports           | company_id                | 1          | 1           | 0         | 16        |
| public     | work_reports           | created_at                | -1         | 0.522807    | 0         | 8         |
| public     | work_reports           | created_by                | 1          | 1           | 0         | 16        |
| public     | work_reports           | deleted_at                | 0          | null        | 1         | 8         |
| public     | work_reports           | description               | 0          | null        | 1         | 0         |
| public     | work_reports           | duration_hours            | -0.368421  | 0.385294    | 0.157895  | 6         |
| public     | work_reports           | end_time                  | 0          | null        | 1         | 8         |
| public     | work_reports           | exchangeable_calcium      | 0          | null        | 1         | 4         |
| public     | work_reports           | exchangeable_magnesium    | 0          | null        | 1         | 4         |
| public     | work_reports           | exchangeable_potassium    | 0          | null        | 1         | 4         |
| public     | work_reports           | expected_price            | -0.0526316 | null        | 0.947368  | 5         |
| public     | work_reports           | free_iron_oxide           | 0          | null        | 1         | 0         |
| public     | work_reports           | growing_task_id           | 0          | null        | 1         | 16        |
| public     | work_reports           | harvest_amount            | -0.0526316 | null        | 0.947368  | 5         |
| public     | work_reports           | harvest_quality           | 0          | null        | 1         | 0         |
| public     | work_reports           | harvest_unit              | -0.0526316 | null        | 0.947368  | 3         |
| public     | work_reports           | humidity                  | -0.368421  | 0.454545    | 0.421053  | 4         |
| public     | work_reports           | humus_content             | 0          | null        | 1         | 0         |
| public     | work_reports           | id                        | -1         | 0.150877    | 0         | 16        |
| public     | work_reports           | magnesium_potassium_ratio | 0          | null        | 1         | 0         |
| public     | work_reports           | manganese                 | 0          | null        | 1         | 0         |
| public     | work_reports           | nitrate_nitrogen          | 0          | null        | 1         | 0         |
| public     | work_reports           | notes                     | -0.105263  | 0.950877    | 0         | 64        |
| public     | work_reports           | phosphorus_absorption     | 0          | null        | 1         | 4         |
| public     | work_reports           | soil_ec                   | 0          | null        | 1         | 0         |
| public     | work_reports           | soil_notes                | 0          | null        | 1         | 0         |
| public     | work_reports           | soil_ph                   | 0          | null        | 1         | 0         |
| public     | work_reports           | start_time                | 0          | null        | 1         | 8         |
| public     | work_reports           | temperature               | -0.315789  | 0.217857    | 0.210526  | 5         |
| public     | work_reports           | updated_at                | -1         | 0.773684    | 0         | 8         |
| public     | work_reports           | vegetable_id              | -0.105263  | 0.994737    | 0         | 16        |
| public     | work_reports           | weather                   | -0.157895  | 0.146853    | 0.368421  | 6         |
| public     | work_reports           | work_date                 | -0.684211  | 0.0526316   | 0         | 4         |
| public     | work_reports           | work_type                 | -0.368421  | 0.0894737   | 0         | 8         |
| public     | work_reports           | worker_count              | -0.368421  | 0.438596    | 0         | 4         |

=================================================================
  3. データ量とパフォーマンス統計

 -- 3.1 各テーブルのレコード数と容量
「ERROR:  42703: column "tablename" does not exist
LINE 4:       tablename,
              ^」

 -- 3.2 会社ごとのデータ分布
 | table_name             | company_id                           | record_count | earliest_date | latest_date | vegetable_count |
| ---------------------- | ------------------------------------ | ------------ | ------------- | ----------- | --------------- |
| work_report_accounting | 4cb3e254-9d73-4d67-b9ae-433bf249fe38 | 11           | 2025-05-22    | 2025-11-13  | 3               |
| work_reports           | 4cb3e254-9d73-4d67-b9ae-433bf249fe38 | 10           | 2025-05-22    | 2025-11-13  | 3               |

==================================================================
  4. RLSポリシーの完全な確認

-- 4.1 全RLSポリシーの詳細
| schemaname | tablename                  | policyname                                            | permissive | roles    | cmd    | qual                                                                                                                                                                                   | with_check                                                                                                                                                                             |
| ---------- | -------------------------- | ----------------------------------------------------- | ---------- | -------- | ------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| public     | accounting_items           | All authenticated users can view accounting items     | PERMISSIVE | {public} | SELECT | (auth.role() = 'authenticated'::text)                                                                                                                                                  | null                                                                                                                                                                                   |
| public     | accounting_items           | Only admins can manage accounting items               | PERMISSIVE | {public} | ALL    | false                                                                                                                                                                                  | false                                                                                                                                                                                  |
| public     | accounting_items           | accounting_items_select_all                           | PERMISSIVE | {public} | SELECT | true                                                                                                                                                                                   | null                                                                                                                                                                                   |
| public     | accounting_recommendations | accounting_recommendations_company_access             | PERMISSIVE | {public} | ALL    | (company_id = get_current_company_id())                                                                                                                                                | null                                                                                                                                                                                   |
| public     | work_report_accounting     | Users can delete their company work report accounting | PERMISSIVE | {public} | DELETE | (EXISTS ( SELECT 1
   FROM (work_reports wr
     JOIN users u ON ((u.company_id = wr.company_id)))
  WHERE ((wr.id = work_report_accounting.work_report_id) AND (u.id = auth.uid())))) | null                                                                                                                                                                                   |
| public     | work_report_accounting     | Users can insert their company work report accounting | PERMISSIVE | {public} | INSERT | null                                                                                                                                                                                   | (EXISTS ( SELECT 1
   FROM (work_reports wr
     JOIN users u ON ((u.company_id = wr.company_id)))
  WHERE ((wr.id = work_report_accounting.work_report_id) AND (u.id = auth.uid())))) |
| public     | work_report_accounting     | Users can update their company work report accounting | PERMISSIVE | {public} | UPDATE | (EXISTS ( SELECT 1
   FROM (work_reports wr
     JOIN users u ON ((u.company_id = wr.company_id)))
  WHERE ((wr.id = work_report_accounting.work_report_id) AND (u.id = auth.uid())))) | null                                                                                                                                                                                   |
| public     | work_report_accounting     | Users can view their company work report accounting   | PERMISSIVE | {public} | SELECT | (EXISTS ( SELECT 1
   FROM (work_reports wr
     JOIN users u ON ((u.company_id = wr.company_id)))
  WHERE ((wr.id = work_report_accounting.work_report_id) AND (u.id = auth.uid())))) | null                                                                                                                                                                                   |
| public     | work_report_accounting     | work_report_accounting_company_access                 | PERMISSIVE | {public} | ALL    | (EXISTS ( SELECT 1
   FROM work_reports wr
  WHERE ((wr.id = work_report_accounting.work_report_id) AND (wr.company_id = get_current_company_id()))))                                  | null                                                                                                                                                                                   |
| public     | work_reports               | work_reports_access                                   | PERMISSIVE | {public} | ALL    | (is_service_role() OR ((company_id = get_current_company_id()) AND (deleted_at IS NULL)))                                                                                              | (is_service_role() OR (company_id = get_current_company_id()))                                                                                                                         |
 
 4.2 RLS有効状態とオーナー確認（修正版）
| schemaname | tablename                  | tableowner | rowsecurity | rls_status |
| ---------- | -------------------------- | ---------- | ----------- | ---------- |
| public     | accounting_items           | postgres   | true        | ENABLED    |
| public     | accounting_recommendations | postgres   | true        | ENABLED    |
| public     | work_report_accounting     | postgres   | true        | ENABLED    |
| public     | work_reports               | postgres   | true        | ENABLED    |

==============================================================
  5. クエリパフォーマンスの診断

   -- 5.1 遅いクエリの特定（実際のクエリ実行計画）
| QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [{"Plan":{"Node Type":"Limit","Parallel Aware":false,"Async Capable":false,"Startup Cost":2.5,"Total Cost":4.1,"Plan Rows":1,"Plan Width":159,"Actual Startup Time":0.069,"Actual Total Time":0.071,"Actual Rows":0,"Actual Loops":1,"Shared Hit Blocks":2,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0,"Plans":[{"Node Type":"Limit","Parent Relationship":"InitPlan","Subplan Name":"InitPlan 1","Parallel Aware":false,"Async Capable":false,"Startup Cost":0,"Total Cost":1.18,"Plan Rows":1,"Plan Width":16,"Actual Startup Time":0,"Actual Total Time":0,"Actual Rows":0,"Actual Loops":0,"Shared Hit Blocks":0,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0,"Plans":[{"Node Type":"Seq Scan","Parent Relationship":"Outer","Parallel Aware":false,"Async Capable":false,"Relation Name":"users","Alias":"users","Startup Cost":0,"Total Cost":1.18,"Plan Rows":1,"Plan Width":16,"Actual Startup Time":0,"Actual Total Time":0,"Actual Rows":0,"Actual Loops":0,"Filter":"(id = (COALESCE(NULLIF(current_setting('request.jwt.claim.sub'::text, true), ''::text), ((NULLIF(current_setting('request.jwt.claims'::text, true), ''::text))::jsonb ->> 'sub'::text)))::uuid)","Rows Removed by Filter":0,"Shared Hit Blocks":0,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0}]},{"Node Type":"Nested Loop","Parent Relationship":"Outer","Parallel Aware":false,"Async Capable":false,"Join Type":"Inner","Startup Cost":1.32,"Total Cost":2.93,"Plan Rows":1,"Plan Width":159,"Actual Startup Time":0.068,"Actual Total Time":0.069,"Actual Rows":0,"Actual Loops":1,"Inner Unique":true,"Shared Hit Blocks":2,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0,"Plans":[{"Node Type":"Hash Join","Parent Relationship":"Outer","Parallel Aware":false,"Async Capable":false,"Join Type":"Inner","Startup Cost":1.19,"Total Cost":2.34,"Plan Rows":1,"Plan Width":134,"Actual Startup Time":0.068,"Actual Total Time":0.069,"Actual Rows":0,"Actual Loops":1,"Inner Unique":true,"Hash Cond":"(wra.work_report_id = wr.id)","Shared Hit Blocks":2,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0,"Plans":[{"Node Type":"Seq Scan","Parent Relationship":"Outer","Parallel Aware":false,"Async Capable":false,"Relation Name":"work_report_accounting","Alias":"wra","Startup Cost":0,"Total Cost":1.11,"Plan Rows":11,"Plan Width":114,"Actual Startup Time":0.041,"Actual Total Time":0.041,"Actual Rows":1,"Actual Loops":1,"Shared Hit Blocks":1,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0},{"Node Type":"Hash","Parent Relationship":"Inner","Parallel Aware":false,"Async Capable":false,"Startup Cost":1.18,"Total Cost":1.18,"Plan Rows":1,"Plan Width":36,"Actual Startup Time":0.013,"Actual Total Time":0.013,"Actual Rows":0,"Actual Loops":1,"Hash Buckets":1024,"Original Hash Buckets":1024,"Hash Batches":1,"Original Hash Batches":1,"Peak Memory Usage":8,"Shared Hit Blocks":1,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0,"Plans":[{"Node Type":"Seq Scan","Parent Relationship":"Outer","Parallel Aware":false,"Async Capable":false,"Relation Name":"work_reports","Alias":"wr","Startup Cost":0,"Total Cost":1.18,"Plan Rows":1,"Plan Width":36,"Actual Startup Time":0.012,"Actual Total Time":0.012,"Actual Rows":0,"Actual Loops":1,"Filter":"((work_date >= '2024-01-01'::date) AND (work_date <= '2024-12-31'::date) AND (company_id = (InitPlan 1).col1))","Rows Removed by Filter":10,"Shared Hit Blocks":1,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0}]}]},{"Node Type":"Index Scan","Parent Relationship":"Inner","Parallel Aware":false,"Async Capable":false,"Scan Direction":"Forward","Index Name":"accounting_items_pkey","Relation Name":"accounting_items","Alias":"ai","Startup Cost":0.14,"Total Cost":0.56,"Plan Rows":1,"Plan Width":41,"Actual Startup Time":0,"Actual Total Time":0,"Actual Rows":0,"Actual Loops":0,"Index Cond":"(id = wra.accounting_item_id)","Rows Removed by Index Recheck":0,"Shared Hit Blocks":0,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0}]}]},"Planning":{"Shared Hit Blocks":594,"Shared Read Blocks":0,"Shared Dirtied Blocks":0,"Shared Written Blocks":0,"Local Hit Blocks":0,"Local Read Blocks":0,"Local Dirtied Blocks":0,"Local Written Blocks":0,"Temp Read Blocks":0,"Temp Written Blocks":0},"Planning Time":4.387,"Triggers":[],"Execution Time":0.189}] |

 -- 5.2 JOINコストの分析
 | QUERY PLAN                                                                                                                                                                                                              |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Aggregate  (cost=3.60..3.61 rows=1 width=8) (actual time=0.055..0.057 rows=1 loops=1)                                                                                                                                   |
|   Buffers: shared hit=3                                                                                                                                                                                                 |
|   InitPlan 1                                                                                                                                                                                                            |
|     ->  Limit  (cost=0.00..1.18 rows=1 width=16) (actual time=0.013..0.013 rows=0 loops=1)                                                                                                                              |
|           Buffers: shared hit=1                                                                                                                                                                                         |
|           ->  Seq Scan on users  (cost=0.00..1.18 rows=1 width=16) (actual time=0.012..0.012 rows=0 loops=1)                                                                                                            |
|                 Filter: (id = (COALESCE(NULLIF(current_setting('request.jwt.claim.sub'::text, true), ''::text), ((NULLIF(current_setting('request.jwt.claims'::text, true), ''::text))::jsonb ->> 'sub'::text)))::uuid) |
|                 Rows Removed by Filter: 5                                                                                                                                                                               |
|                 Buffers: shared hit=1                                                                                                                                                                                   |
|   ->  Hash Join  (cost=1.25..2.40 rows=11 width=0) (actual time=0.053..0.054 rows=0 loops=1)                                                                                                                            |
|         Hash Cond: (wra.work_report_id = wr.id)                                                                                                                                                                         |
|         Buffers: shared hit=3                                                                                                                                                                                           |
|         ->  Seq Scan on work_report_accounting wra  (cost=0.00..1.11 rows=11 width=16) (actual time=0.016..0.016 rows=1 loops=1)                                                                                        |
|               Buffers: shared hit=1                                                                                                                                                                                     |
|         ->  Hash  (cost=1.12..1.12 rows=10 width=16) (actual time=0.027..0.027 rows=0 loops=1)                                                                                                                          |
|               Buckets: 1024  Batches: 1  Memory Usage: 8kB                                                                                                                                                              |
|               Buffers: shared hit=2                                                                                                                                                                                     |
|               ->  Seq Scan on work_reports wr  (cost=0.00..1.12 rows=10 width=16) (actual time=0.027..0.027 rows=0 loops=1)                                                                                             |
|                     Filter: (company_id = (InitPlan 1).col1)                                                                                                                                                            |
|                     Rows Removed by Filter: 10                                                                                                                                                                          |
|                     Buffers: shared hit=2                                                                                                                                                                               |
| Planning:                                                                                                                                                                                                               |
|   Buffers: shared hit=478                                                                                                                                                                                               |
| Planning Time: 1.550 ms                                                                                                                                                                                                 |
| Execution Time: 0.164 ms                                                                                                                                                                                                |

=================================================================
  6. 関数とトリガーの確認

  -- 6.1 get_current_company_id関数の詳細
  | function_name          | volatility | security_definer | kind | source_code                                                                                                                                                                      |
| ---------------------- | ---------- | ---------------- | ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get_current_company_id | s          | true             | f    | 
  DECLARE
    company_id uuid;
  BEGIN
    SELECT u.company_id INTO company_id
    FROM public.users u
    WHERE u.id = auth.uid();

    RETURN company_id;
  END;
   |

   -- 6.2 既存トリガーの確認
   | trigger_schema | trigger_name                   | event_object_table | action_statement                     | action_orientation | action_timing |
| -------------- | ------------------------------ | ------------------ | ------------------------------------ | ------------------ | ------------- |
| public         | update_work_reports_updated_at | work_reports       | EXECUTE FUNCTION update_updated_at() | ROW                | BEFORE        |

==============================================================
  7. データ整合性チェック

-- 7.1 孤立レコードの確認
| orphaned_accounting_records |
| --------------------------- |
| 0                           |

-- 7.2 NULL値の分布
| table_name             | total_records | null_company_id | null_vegetable_id | null_work_date |
| ---------------------- | ------------- | --------------- | ----------------- | -------------- |
| work_reports           | 10            | 0               | 0                 | 0              |
| work_report_accounting | 11            | 0               | 0                 | 0              |

 -- 7.3 重複データチェック
 [Success. No rows returned]

=============================================================
  8. 最適化機会の特定

  -- 8.1 頻繁に使用されるクエリパターンの特定
  | calls | mean_exec_time     | total_exec_time  | query                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ----- | ------------------ | ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 5159  | 0.977595914518314  | 5043.41732299999 | WITH pgrst_source AS ( SELECT "public"."work_reports"."id", "public"."work_reports"."company_id", "public"."work_reports"."vegetable_id", "public"."work_reports"."work_type", "public"."work_reports"."description", "public"."work_reports"."work_date", "public"."work_reports"."start_time", "public"."work_reports"."end_time", "public"."work_reports"."duration_hours", "public"."work_reports"."weather", "public"."work_reports"."temperature", "public"."work_reports"."harvest_amount", "public"."work_reports"."harvest_unit", "public"."work_reports"."harvest_quality", "public"."work_reports"."expected_price", "public"."work_reports"."worker_count", "public"."work_reports"."notes", "public"."work_reports"."created_by", "public"."work_reports"."created_at", "public"."work_reports"."soil_ph", "public"."work_reports"."soil_ec", "public"."work_reports"."phosphorus_absorption", "public"."work_reports"."cec", "public"."work_reports"."base_saturation", "public"."work_reports"."exchangeable_calcium", "public"."work_reports"."exchangeable_magnesium", "public"."work_reports"."exchangeable_potassium", "public"."work_reports"."humus_content", "public"."work_reports"."available_phosphorus", "public"."work_reports"."available_silica", "public"."work_reports"."ammonium_nitrogen", "public"."work_reports"."nitrate_nitrogen", "public"."work_reports"."soil_notes", row_to_json("work_reports_vegetables_1".*)::jsonb AS "vegetables", COALESCE( "work_reports_work_report_accounting_1"."work_reports_work_report_accounting_1", $12) AS "work_report_accounting" FROM "public"."work_reports" LEFT JOIN LATERAL ( SELECT "vegetables_1"."id", "vegetables_1"."name", "vegetables_1"."variety_name", "vegetables_1"."plot_name" FROM "public"."vegetables" AS "vegetables_1" WHERE "vegetables_1"."id" = "public"."work_reports"."vegetable_id"   LIMIT $1 OFFSET $2 ) AS "work_reports_vegetables_1" ON $13  LEFT JOIN LATERAL ( SELECT json_agg("work_reports_work_report_accounting_1")::jsonb AS "work_reports_work_report_accounting_1" FROM (SELECT "work_report_accounting_1"."id", "work_report_accounting_1"."accounting_item_id", "work_report_accounting_1"."amount", "work_report_accounting_1"."custom_item_name", "work_report_accounting_1"."notes", "work_report_accounting_1"."is_ai_recommended", row_to_json("work_report_accounting_accounting_items_2".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" AS "work_report_accounting_1" LEFT JOIN LATERAL ( SELECT "accounting_items_2"."id", "accounting_items_2"."code", "accounting_items_2"."name", "accounting_items_2"."type", "accounting_items_2"."category" FROM "public"."accounting_items" AS "accounting_items_2" WHERE "accounting_items_2"."id" = "work_report_accounting_1"."accounting_item_id"   LIMIT $3 OFFSET $4 ) AS "work_report_accounting_accounting_items_2" ON $14 WHERE "work_report_accounting_1"."work_report_id" = "public"."work_reports"."id"   LIMIT $5 OFFSET $6 ) AS "work_reports_work_report_accounting_1" ) AS "work_reports_work_report_accounting_1" ON $15 WHERE  "public"."work_reports"."company_id" = $7 AND  "public"."work_reports"."work_date" >= $8 AND  "public"."work_reports"."work_date" <= $9  ORDER BY "public"."work_reports"."work_date" DESC , "public"."work_reports"."created_at" DESC  LIMIT $10 OFFSET $11 )  SELECT $16::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $17) AS body, nullif(current_setting($18, $19), $20) AS response_headers, nullif(current_setting($21, $22), $23) AS response_status, $24 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t                                                                                                                                                                  |
| 2751  | 1.60718203853144   | 4421.357788      | WITH pgrst_source AS ( SELECT "public"."work_reports"."id", "public"."work_reports"."company_id", "public"."work_reports"."vegetable_id", "public"."work_reports"."work_type", "public"."work_reports"."description", "public"."work_reports"."work_date", "public"."work_reports"."start_time", "public"."work_reports"."end_time", "public"."work_reports"."duration_hours", "public"."work_reports"."work_duration", "public"."work_reports"."worker_count", "public"."work_reports"."weather", "public"."work_reports"."temperature", "public"."work_reports"."humidity", "public"."work_reports"."harvest_amount", "public"."work_reports"."harvest_unit", "public"."work_reports"."harvest_quality", "public"."work_reports"."expected_price", "public"."work_reports"."notes", "public"."work_reports"."created_by", "public"."work_reports"."created_at", "public"."work_reports"."soil_ph", "public"."work_reports"."soil_ec", "public"."work_reports"."phosphorus_absorption", "public"."work_reports"."cec", "public"."work_reports"."base_saturation", "public"."work_reports"."exchangeable_calcium", "public"."work_reports"."exchangeable_magnesium", "public"."work_reports"."exchangeable_potassium", "public"."work_reports"."humus_content", "public"."work_reports"."available_phosphorus", "public"."work_reports"."available_silica", "public"."work_reports"."ammonium_nitrogen", "public"."work_reports"."nitrate_nitrogen", "public"."work_reports"."soil_notes", row_to_json("work_reports_vegetables_1".*)::jsonb AS "vegetables", COALESCE( "work_reports_work_report_accounting_1"."work_reports_work_report_accounting_1", $12) AS "work_report_accounting" FROM "public"."work_reports" LEFT JOIN LATERAL ( SELECT "vegetables_1"."id", "vegetables_1"."name", "vegetables_1"."variety_name", "vegetables_1"."plot_name" FROM "public"."vegetables" AS "vegetables_1" WHERE "vegetables_1"."id" = "public"."work_reports"."vegetable_id"   LIMIT $1 OFFSET $2 ) AS "work_reports_vegetables_1" ON $13  LEFT JOIN LATERAL ( SELECT json_agg("work_reports_work_report_accounting_1")::jsonb AS "work_reports_work_report_accounting_1" FROM (SELECT "work_report_accounting_1"."id", "work_report_accounting_1"."accounting_item_id", "work_report_accounting_1"."amount", "work_report_accounting_1"."custom_item_name", "work_report_accounting_1"."notes", "work_report_accounting_1"."is_ai_recommended", row_to_json("work_report_accounting_accounting_items_2".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" AS "work_report_accounting_1" LEFT JOIN LATERAL ( SELECT "accounting_items_2"."id", "accounting_items_2"."code", "accounting_items_2"."name", "accounting_items_2"."type", "accounting_items_2"."category", "accounting_items_2"."cost_type" FROM "public"."accounting_items" AS "accounting_items_2" WHERE "accounting_items_2"."id" = "work_report_accounting_1"."accounting_item_id"   LIMIT $3 OFFSET $4 ) AS "work_report_accounting_accounting_items_2" ON $14 WHERE "work_report_accounting_1"."work_report_id" = "public"."work_reports"."id"   LIMIT $5 OFFSET $6 ) AS "work_reports_work_report_accounting_1" ) AS "work_reports_work_report_accounting_1" ON $15 WHERE  "public"."work_reports"."company_id" = $7 AND  "public"."work_reports"."deleted_at" IS NULL AND  "public"."work_reports"."work_date" >= $8 AND  "public"."work_reports"."work_date" <= $9  ORDER BY "public"."work_reports"."work_date" DESC , "public"."work_reports"."created_at" DESC  LIMIT $10 OFFSET $11 )  SELECT $16::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $17) AS body, nullif(current_setting($18, $19), $20) AS response_headers, nullif(current_setting($21, $22), $23) AS response_status, $24 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t |
| 1173  | 1.53231912446718   | 1797.410333      | WITH pgrst_source AS ( SELECT "public"."work_reports"."id", "public"."work_reports"."company_id", "public"."work_reports"."vegetable_id", "public"."work_reports"."work_type", "public"."work_reports"."description", "public"."work_reports"."work_date", "public"."work_reports"."start_time", "public"."work_reports"."end_time", "public"."work_reports"."duration_hours", "public"."work_reports"."work_duration", "public"."work_reports"."worker_count", "public"."work_reports"."weather", "public"."work_reports"."temperature", "public"."work_reports"."humidity", "public"."work_reports"."harvest_amount", "public"."work_reports"."harvest_unit", "public"."work_reports"."harvest_quality", "public"."work_reports"."expected_price", "public"."work_reports"."notes", "public"."work_reports"."created_by", "public"."work_reports"."created_at", "public"."work_reports"."soil_ph", "public"."work_reports"."soil_ec", "public"."work_reports"."phosphorus_absorption", "public"."work_reports"."cec", "public"."work_reports"."base_saturation", "public"."work_reports"."exchangeable_calcium", "public"."work_reports"."exchangeable_magnesium", "public"."work_reports"."exchangeable_potassium", "public"."work_reports"."humus_content", "public"."work_reports"."available_phosphorus", "public"."work_reports"."available_silica", "public"."work_reports"."ammonium_nitrogen", "public"."work_reports"."nitrate_nitrogen", "public"."work_reports"."soil_notes", row_to_json("work_reports_vegetables_1".*)::jsonb AS "vegetables", COALESCE( "work_reports_work_report_accounting_1"."work_reports_work_report_accounting_1", $12) AS "work_report_accounting" FROM "public"."work_reports" LEFT JOIN LATERAL ( SELECT "vegetables_1"."id", "vegetables_1"."name", "vegetables_1"."variety_name", "vegetables_1"."plot_name" FROM "public"."vegetables" AS "vegetables_1" WHERE "vegetables_1"."id" = "public"."work_reports"."vegetable_id"   LIMIT $1 OFFSET $2 ) AS "work_reports_vegetables_1" ON $13  LEFT JOIN LATERAL ( SELECT json_agg("work_reports_work_report_accounting_1")::jsonb AS "work_reports_work_report_accounting_1" FROM (SELECT "work_report_accounting_1"."id", "work_report_accounting_1"."accounting_item_id", "work_report_accounting_1"."amount", "work_report_accounting_1"."custom_item_name", "work_report_accounting_1"."notes", "work_report_accounting_1"."is_ai_recommended", row_to_json("work_report_accounting_accounting_items_2".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" AS "work_report_accounting_1" LEFT JOIN LATERAL ( SELECT "accounting_items_2"."id", "accounting_items_2"."code", "accounting_items_2"."name", "accounting_items_2"."type", "accounting_items_2"."category" FROM "public"."accounting_items" AS "accounting_items_2" WHERE "accounting_items_2"."id" = "work_report_accounting_1"."accounting_item_id"   LIMIT $3 OFFSET $4 ) AS "work_report_accounting_accounting_items_2" ON $14 WHERE "work_report_accounting_1"."work_report_id" = "public"."work_reports"."id"   LIMIT $5 OFFSET $6 ) AS "work_reports_work_report_accounting_1" ) AS "work_reports_work_report_accounting_1" ON $15 WHERE  "public"."work_reports"."company_id" = $7 AND  "public"."work_reports"."deleted_at" IS NULL AND  "public"."work_reports"."work_date" >= $8 AND  "public"."work_reports"."work_date" <= $9  ORDER BY "public"."work_reports"."work_date" DESC , "public"."work_reports"."created_at" DESC  LIMIT $10 OFFSET $11 )  SELECT $16::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $17) AS body, nullif(current_setting($18, $19), $20) AS response_headers, nullif(current_setting($21, $22), $23) AS response_status, $24 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t                                   |
| 617   | 1.94216522042139   | 1198.315941      | WITH pgrst_source AS ( SELECT "public"."work_reports"."id", "public"."work_reports"."company_id", "public"."work_reports"."vegetable_id", "public"."work_reports"."work_type", "public"."work_reports"."description", "public"."work_reports"."work_date", "public"."work_reports"."start_time", "public"."work_reports"."end_time", "public"."work_reports"."duration_hours", "public"."work_reports"."weather", "public"."work_reports"."temperature", "public"."work_reports"."harvest_amount", "public"."work_reports"."harvest_unit", "public"."work_reports"."harvest_quality", "public"."work_reports"."expected_price", "public"."work_reports"."worker_count", "public"."work_reports"."notes", "public"."work_reports"."created_by", "public"."work_reports"."created_at", "public"."work_reports"."soil_ph", "public"."work_reports"."soil_ec", "public"."work_reports"."phosphorus_absorption", "public"."work_reports"."cec", "public"."work_reports"."base_saturation", "public"."work_reports"."exchangeable_calcium", "public"."work_reports"."exchangeable_magnesium", "public"."work_reports"."exchangeable_potassium", "public"."work_reports"."humus_content", "public"."work_reports"."available_phosphorus", "public"."work_reports"."available_silica", "public"."work_reports"."ammonium_nitrogen", "public"."work_reports"."nitrate_nitrogen", "public"."work_reports"."soil_notes", row_to_json("work_reports_vegetables_1".*)::jsonb AS "vegetables", COALESCE( "work_reports_work_report_accounting_1"."work_reports_work_report_accounting_1", $10) AS "work_report_accounting" FROM "public"."work_reports" LEFT JOIN LATERAL ( SELECT "vegetables_1"."id", "vegetables_1"."name", "vegetables_1"."variety_name", "vegetables_1"."plot_name" FROM "public"."vegetables" AS "vegetables_1" WHERE "vegetables_1"."id" = "public"."work_reports"."vegetable_id"   LIMIT $1 OFFSET $2 ) AS "work_reports_vegetables_1" ON $11  LEFT JOIN LATERAL ( SELECT json_agg("work_reports_work_report_accounting_1")::jsonb AS "work_reports_work_report_accounting_1" FROM (SELECT "work_report_accounting_1"."id", "work_report_accounting_1"."accounting_item_id", "work_report_accounting_1"."amount", "work_report_accounting_1"."custom_item_name", "work_report_accounting_1"."notes", "work_report_accounting_1"."is_ai_recommended", row_to_json("work_report_accounting_accounting_items_2".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" AS "work_report_accounting_1" LEFT JOIN LATERAL ( SELECT "accounting_items_2"."id", "accounting_items_2"."code", "accounting_items_2"."name", "accounting_items_2"."type", "accounting_items_2"."category" FROM "public"."accounting_items" AS "accounting_items_2" WHERE "accounting_items_2"."id" = "work_report_accounting_1"."accounting_item_id"   LIMIT $3 OFFSET $4 ) AS "work_report_accounting_accounting_items_2" ON $12 WHERE "work_report_accounting_1"."work_report_id" = "public"."work_reports"."id"   LIMIT $5 OFFSET $6 ) AS "work_reports_work_report_accounting_1" ) AS "work_reports_work_report_accounting_1" ON $13 WHERE  "public"."work_reports"."company_id" = $7  ORDER BY "public"."work_reports"."work_date" DESC , "public"."work_reports"."created_at" DESC  LIMIT $8 OFFSET $9 )  SELECT $14::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $15) AS body, nullif(current_setting($16, $17), $18) AS response_headers, nullif(current_setting($19, $20), $21) AS response_status, $22 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t                                                                                                                                                                                                                                                                  |
| 1842  | 0.580331635179154  | 1068.970872      | WITH pgrst_source AS ( SELECT "public"."work_reports"."id", "public"."work_reports"."company_id", "public"."work_reports"."vegetable_id", "public"."work_reports"."work_type", "public"."work_reports"."description", "public"."work_reports"."work_date", "public"."work_reports"."start_time", "public"."work_reports"."end_time", "public"."work_reports"."duration_hours", "public"."work_reports"."weather", "public"."work_reports"."temperature", "public"."work_reports"."harvest_amount", "public"."work_reports"."harvest_unit", "public"."work_reports"."harvest_quality", "public"."work_reports"."expected_price", "public"."work_reports"."worker_count", "public"."work_reports"."notes", "public"."work_reports"."created_by", "public"."work_reports"."created_at", "public"."work_reports"."soil_ph", "public"."work_reports"."soil_ec", "public"."work_reports"."phosphorus_absorption", "public"."work_reports"."cec", "public"."work_reports"."base_saturation", "public"."work_reports"."exchangeable_calcium", "public"."work_reports"."exchangeable_magnesium", "public"."work_reports"."exchangeable_potassium", "public"."work_reports"."humus_content", "public"."work_reports"."available_phosphorus", "public"."work_reports"."available_silica", "public"."work_reports"."ammonium_nitrogen", "public"."work_reports"."nitrate_nitrogen", "public"."work_reports"."soil_notes", row_to_json("work_reports_vegetables_1".*)::jsonb AS "vegetables", COALESCE( "work_reports_work_report_accounting_1"."work_reports_work_report_accounting_1", $12) AS "work_report_accounting" FROM "public"."work_reports" LEFT JOIN LATERAL ( SELECT "vegetables_1"."id", "vegetables_1"."name", "vegetables_1"."variety_name", "vegetables_1"."plot_name" FROM "public"."vegetables" AS "vegetables_1" WHERE "vegetables_1"."id" = "public"."work_reports"."vegetable_id"   LIMIT $1 OFFSET $2 ) AS "work_reports_vegetables_1" ON $13  LEFT JOIN LATERAL ( SELECT json_agg("work_reports_work_report_accounting_1")::jsonb AS "work_reports_work_report_accounting_1" FROM (SELECT "work_report_accounting_1"."id", "work_report_accounting_1"."accounting_item_id", "work_report_accounting_1"."amount", "work_report_accounting_1"."custom_item_name", "work_report_accounting_1"."notes", "work_report_accounting_1"."is_ai_recommended", row_to_json("work_report_accounting_accounting_items_2".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" AS "work_report_accounting_1" LEFT JOIN LATERAL ( SELECT "accounting_items_2"."id", "accounting_items_2"."code", "accounting_items_2"."name", "accounting_items_2"."type", "accounting_items_2"."category" FROM "public"."accounting_items" AS "accounting_items_2" WHERE "accounting_items_2"."id" = "work_report_accounting_1"."accounting_item_id"   LIMIT $3 OFFSET $4 ) AS "work_report_accounting_accounting_items_2" ON $14 WHERE "work_report_accounting_1"."work_report_id" = "public"."work_reports"."id"   LIMIT $5 OFFSET $6 ) AS "work_reports_work_report_accounting_1" ) AS "work_reports_work_report_accounting_1" ON $15 WHERE  "public"."work_reports"."company_id" = $7 AND  "public"."work_reports"."deleted_at" IS NULL AND  "public"."work_reports"."work_date" >= $8 AND  "public"."work_reports"."work_date" <= $9  ORDER BY "public"."work_reports"."work_date" DESC , "public"."work_reports"."created_at" DESC  LIMIT $10 OFFSET $11 )  SELECT $16::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $17) AS body, nullif(current_setting($18, $19), $20) AS response_headers, nullif(current_setting($21, $22), $23) AS response_status, $24 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t                                                                                                                |
| 442   | 1.97017527149321   | 870.81747        | WITH pgrst_source AS ( SELECT "public"."work_reports"."id", "public"."work_reports"."company_id", "public"."work_reports"."vegetable_id", "public"."work_reports"."work_type", "public"."work_reports"."description", "public"."work_reports"."work_date", "public"."work_reports"."start_time", "public"."work_reports"."end_time", "public"."work_reports"."duration_hours", "public"."work_reports"."work_duration", "public"."work_reports"."worker_count", "public"."work_reports"."weather", "public"."work_reports"."temperature", "public"."work_reports"."humidity", "public"."work_reports"."harvest_amount", "public"."work_reports"."harvest_unit", "public"."work_reports"."harvest_quality", "public"."work_reports"."expected_price", "public"."work_reports"."notes", "public"."work_reports"."created_by", "public"."work_reports"."created_at", "public"."work_reports"."soil_ph", "public"."work_reports"."soil_ec", "public"."work_reports"."phosphorus_absorption", "public"."work_reports"."cec", "public"."work_reports"."base_saturation", "public"."work_reports"."exchangeable_calcium", "public"."work_reports"."exchangeable_magnesium", "public"."work_reports"."exchangeable_potassium", "public"."work_reports"."humus_content", "public"."work_reports"."available_phosphorus", "public"."work_reports"."available_silica", "public"."work_reports"."ammonium_nitrogen", "public"."work_reports"."nitrate_nitrogen", "public"."work_reports"."soil_notes", row_to_json("work_reports_vegetables_1".*)::jsonb AS "vegetables", COALESCE( "work_reports_work_report_accounting_1"."work_reports_work_report_accounting_1", $12) AS "work_report_accounting" FROM "public"."work_reports" LEFT JOIN LATERAL ( SELECT "vegetables_1"."id", "vegetables_1"."name", "vegetables_1"."variety_name", "vegetables_1"."plot_name" FROM "public"."vegetables" AS "vegetables_1" WHERE "vegetables_1"."id" = "public"."work_reports"."vegetable_id"   LIMIT $1 OFFSET $2 ) AS "work_reports_vegetables_1" ON $13  LEFT JOIN LATERAL ( SELECT json_agg("work_reports_work_report_accounting_1")::jsonb AS "work_reports_work_report_accounting_1" FROM (SELECT "work_report_accounting_1"."id", "work_report_accounting_1"."accounting_item_id", "work_report_accounting_1"."amount", "work_report_accounting_1"."custom_item_name", "work_report_accounting_1"."notes", "work_report_accounting_1"."is_ai_recommended", row_to_json("work_report_accounting_accounting_items_2".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" AS "work_report_accounting_1" LEFT JOIN LATERAL ( SELECT "accounting_items_2"."id", "accounting_items_2"."code", "accounting_items_2"."name", "accounting_items_2"."type", "accounting_items_2"."category", "accounting_items_2"."cost_type" FROM "public"."accounting_items" AS "accounting_items_2" WHERE "accounting_items_2"."id" = "work_report_accounting_1"."accounting_item_id"   LIMIT $3 OFFSET $4 ) AS "work_report_accounting_accounting_items_2" ON $14 WHERE "work_report_accounting_1"."work_report_id" = "public"."work_reports"."id"   LIMIT $5 OFFSET $6 ) AS "work_reports_work_report_accounting_1" ) AS "work_reports_work_report_accounting_1" ON $15 WHERE  "public"."work_reports"."company_id" = $7 AND  "public"."work_reports"."deleted_at" IS NULL AND  "public"."work_reports"."work_date" >= $8 AND  "public"."work_reports"."work_date" <= $9  ORDER BY "public"."work_reports"."work_date" DESC , "public"."work_reports"."created_at" DESC  LIMIT $10 OFFSET $11 )  SELECT $16::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $17) AS body, nullif(current_setting($18, $19), $20) AS response_headers, nullif(current_setting($21, $22), $23) AS response_status, $24 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t |
| 682   | 1.18304475219941   | 806.836521000001 | WITH pgrst_source AS ( SELECT "public"."work_reports"."id", "public"."work_reports"."company_id", "public"."work_reports"."vegetable_id", "public"."work_reports"."work_type", "public"."work_reports"."description", "public"."work_reports"."work_date", "public"."work_reports"."start_time", "public"."work_reports"."end_time", "public"."work_reports"."duration_hours", "public"."work_reports"."weather", "public"."work_reports"."temperature", "public"."work_reports"."harvest_amount", "public"."work_reports"."harvest_unit", "public"."work_reports"."harvest_quality", "public"."work_reports"."expected_price", "public"."work_reports"."worker_count", "public"."work_reports"."notes", "public"."work_reports"."created_by", "public"."work_reports"."created_at", "public"."work_reports"."soil_ph", "public"."work_reports"."soil_ec", "public"."work_reports"."phosphorus_absorption", "public"."work_reports"."cec", "public"."work_reports"."base_saturation", "public"."work_reports"."exchangeable_calcium", "public"."work_reports"."exchangeable_magnesium", "public"."work_reports"."exchangeable_potassium", "public"."work_reports"."humus_content", "public"."work_reports"."available_phosphorus", "public"."work_reports"."available_silica", "public"."work_reports"."ammonium_nitrogen", "public"."work_reports"."nitrate_nitrogen", "public"."work_reports"."soil_notes", row_to_json("work_reports_vegetables_1".*)::jsonb AS "vegetables", COALESCE( "work_reports_work_report_accounting_1"."work_reports_work_report_accounting_1", $12) AS "work_report_accounting" FROM "public"."work_reports" LEFT JOIN LATERAL ( SELECT "vegetables_1"."id", "vegetables_1"."name", "vegetables_1"."variety_name", "vegetables_1"."plot_name" FROM "public"."vegetables" AS "vegetables_1" WHERE "vegetables_1"."id" = "public"."work_reports"."vegetable_id"   LIMIT $1 OFFSET $2 ) AS "work_reports_vegetables_1" ON $13  LEFT JOIN LATERAL ( SELECT json_agg("work_reports_work_report_accounting_1")::jsonb AS "work_reports_work_report_accounting_1" FROM (SELECT "work_report_accounting_1"."id", "work_report_accounting_1"."accounting_item_id", "work_report_accounting_1"."amount", "work_report_accounting_1"."custom_item_name", "work_report_accounting_1"."notes", "work_report_accounting_1"."is_ai_recommended", row_to_json("work_report_accounting_accounting_items_2".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" AS "work_report_accounting_1" LEFT JOIN LATERAL ( SELECT "accounting_items_2"."id", "accounting_items_2"."code", "accounting_items_2"."name", "accounting_items_2"."type", "accounting_items_2"."category" FROM "public"."accounting_items" AS "accounting_items_2" WHERE "accounting_items_2"."id" = "work_report_accounting_1"."accounting_item_id"   LIMIT $3 OFFSET $4 ) AS "work_report_accounting_accounting_items_2" ON $14 WHERE "work_report_accounting_1"."work_report_id" = "public"."work_reports"."id"   LIMIT $5 OFFSET $6 ) AS "work_reports_work_report_accounting_1" ) AS "work_reports_work_report_accounting_1" ON $15 WHERE  "public"."work_reports"."company_id" = $7 AND  "public"."work_reports"."work_date" >= $8 AND  "public"."work_reports"."work_date" <= $9  ORDER BY "public"."work_reports"."work_date" DESC , "public"."work_reports"."created_at" DESC  LIMIT $10 OFFSET $11 )  SELECT $16::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $17) AS body, nullif(current_setting($18, $19), $20) AS response_headers, nullif(current_setting($21, $22), $23) AS response_status, $24 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t                                                                                                                                                                  |
| 8501  | 0.0614209931772732 | 522.139862999999 | WITH pgrst_source AS ( SELECT "public"."work_report_accounting".*, row_to_json("work_report_accounting_accounting_items_1".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" LEFT JOIN LATERAL ( SELECT "accounting_items_1"."id", "accounting_items_1"."code", "accounting_items_1"."name", "accounting_items_1"."type", "accounting_items_1"."category" FROM "public"."accounting_items" AS "accounting_items_1" WHERE "accounting_items_1"."id" = "public"."work_report_accounting"."accounting_item_id"   LIMIT $1 OFFSET $2 ) AS "work_report_accounting_accounting_items_1" ON $6 WHERE  "public"."work_report_accounting"."work_report_id" = $3  ORDER BY "public"."work_report_accounting"."created_at" ASC  LIMIT $4 OFFSET $5 )  SELECT $7::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $8) AS body, nullif(current_setting($9, $10), $11) AS response_headers, nullif(current_setting($12, $13), $14) AS response_status, $15 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 816   | 0.562476761029411  | 458.981037       | WITH pgrst_source AS ( SELECT "public"."work_report_accounting"."id", "public"."work_report_accounting"."work_report_id", "public"."work_report_accounting"."accounting_item_id", "public"."work_report_accounting"."amount", row_to_json("work_report_accounting_work_reports_1".*)::jsonb AS "work_reports", row_to_json("work_report_accounting_accounting_items_1".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" INNER JOIN LATERAL ( SELECT "work_reports_1"."work_date" FROM "public"."work_reports" AS "work_reports_1" WHERE "work_reports_1"."id" = "public"."work_report_accounting"."work_report_id"   LIMIT $1 OFFSET $2 ) AS "work_report_accounting_work_reports_1" ON $8  INNER JOIN LATERAL ( SELECT "accounting_items_1"."id", "accounting_items_1"."name", "accounting_items_1"."code", "accounting_items_1"."cost_type" FROM "public"."accounting_items" AS "accounting_items_1" WHERE "accounting_items_1"."id" = "public"."work_report_accounting"."accounting_item_id"   LIMIT $3 OFFSET $4 ) AS "work_report_accounting_accounting_items_1" ON $9 WHERE  "public"."work_report_accounting"."work_report_id" = ANY ($5)   ORDER BY "public"."work_report_accounting"."work_report_id" ASC  LIMIT $6 OFFSET $7 )  SELECT $10::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $11) AS body, nullif(current_setting($12, $13), $14) AS response_headers, nullif(current_setting($15, $16), $17) AS response_status, $18 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 167   | 2.02517895209581   | 338.204885       | WITH pgrst_source AS ( SELECT "public"."work_reports"."id", "public"."work_reports"."company_id", "public"."work_reports"."vegetable_id", "public"."work_reports"."work_type", "public"."work_reports"."description", "public"."work_reports"."work_date", "public"."work_reports"."start_time", "public"."work_reports"."end_time", "public"."work_reports"."duration_hours", "public"."work_reports"."weather", "public"."work_reports"."temperature", "public"."work_reports"."harvest_amount", "public"."work_reports"."harvest_unit", "public"."work_reports"."harvest_quality", "public"."work_reports"."expected_price", "public"."work_reports"."worker_count", "public"."work_reports"."notes", "public"."work_reports"."created_by", "public"."work_reports"."created_at", "public"."work_reports"."soil_ph", "public"."work_reports"."soil_ec", "public"."work_reports"."phosphorus_absorption", "public"."work_reports"."cec", "public"."work_reports"."base_saturation", "public"."work_reports"."exchangeable_calcium", "public"."work_reports"."exchangeable_magnesium", "public"."work_reports"."exchangeable_potassium", "public"."work_reports"."humus_content", "public"."work_reports"."available_phosphorus", "public"."work_reports"."available_silica", "public"."work_reports"."ammonium_nitrogen", "public"."work_reports"."nitrate_nitrogen", "public"."work_reports"."soil_notes", row_to_json("work_reports_vegetables_1".*)::jsonb AS "vegetables", COALESCE( "work_reports_work_report_accounting_1"."work_reports_work_report_accounting_1", $10) AS "work_report_accounting" FROM "public"."work_reports" LEFT JOIN LATERAL ( SELECT "vegetables_1"."id", "vegetables_1"."name", "vegetables_1"."variety_name", "vegetables_1"."plot_name" FROM "public"."vegetables" AS "vegetables_1" WHERE "vegetables_1"."id" = "public"."work_reports"."vegetable_id"   LIMIT $1 OFFSET $2 ) AS "work_reports_vegetables_1" ON $11  LEFT JOIN LATERAL ( SELECT json_agg("work_reports_work_report_accounting_1")::jsonb AS "work_reports_work_report_accounting_1" FROM (SELECT "work_report_accounting_1"."id", "work_report_accounting_1"."accounting_item_id", "work_report_accounting_1"."amount", "work_report_accounting_1"."custom_item_name", "work_report_accounting_1"."notes", "work_report_accounting_1"."is_ai_recommended", row_to_json("work_report_accounting_accounting_items_2".*)::jsonb AS "accounting_items" FROM "public"."work_report_accounting" AS "work_report_accounting_1" LEFT JOIN LATERAL ( SELECT "accounting_items_2"."id", "accounting_items_2"."code", "accounting_items_2"."name", "accounting_items_2"."type", "accounting_items_2"."category" FROM "public"."accounting_items" AS "accounting_items_2" WHERE "accounting_items_2"."id" = "work_report_accounting_1"."accounting_item_id"   LIMIT $3 OFFSET $4 ) AS "work_report_accounting_accounting_items_2" ON $12 WHERE "work_report_accounting_1"."work_report_id" = "public"."work_reports"."id"   LIMIT $5 OFFSET $6 ) AS "work_reports_work_report_accounting_1" ) AS "work_reports_work_report_accounting_1" ON $13 WHERE  "public"."work_reports"."company_id" = $7 AND  "public"."work_reports"."deleted_at" IS NULL  ORDER BY "public"."work_reports"."work_date" DESC , "public"."work_reports"."created_at" DESC  LIMIT $8 OFFSET $9 )  SELECT $14::bigint AS total_result_set, pg_catalog.count(_postgrest_t) AS page_total, coalesce(json_agg(_postgrest_t), $15) AS body, nullif(current_setting($16, $17), $18) AS response_headers, nullif(current_setting($19, $20), $21) AS response_status, $22 AS response_inserted FROM ( SELECT * FROM pgrst_source ) _postgrest_t                                                                                                                                                                                                                |

-- 8.2 テーブル統計の鮮度確認
[ERROR:  42703: column "tablename" does not exist
LINE 4:       tablename,
              ^]

===============================================================
  9. 会計項目の使用状況分析

   -- 9.1 会計項目の使用頻度
   | id                                   | code | name          | cost_type     | usage_count | total_amount | avg_amount             | min_amount | max_amount |
| ------------------------------------ | ---- | ------------- | ------------- | ----------- | ------------ | ---------------------- | ---------- | ---------- |
| e8b3c9f3-665a-4a9f-aa82-e0f4a4b487b2 | ①    | 販売金額          | income        | 3           | 1000000.00   | 333333.333333333333    | 200000.00  | 400000.00  |
| 67fb5510-647d-4109-aa8f-d9d73c64f69c | ⑤    | 種苗費           | variable_cost | 3           | 4234234.00   | 1411411.333333333333   | 234234.00  | 3500000.00 |
| 3458c1cd-e9e5-4498-b581-61ded310eedd | ㉓    | 雑費            | fixed_cost    | 1           | 500000.00    | 500000.000000000000    | 500000.00  | 500000.00  |
| 4476c39f-ad9a-4031-b257-843d0139a277 | ⑧    | 飼料費           | variable_cost | 1           | 10000.00     | 10000.0000000000000000 | 10000.00   | 10000.00   |
| 219bbd47-4592-4166-9285-92585687e1a3 | ⑳    | 地代・賃借料        | fixed_cost    | 1           | 2500000.00   | 2500000.000000000000   | 2500000.00 | 2500000.00 |
| 75b7c1ac-efda-4611-a29d-77afe4cada97 | ⑦    | 肥料費           | variable_cost | 1           | 20000.00     | 20000.000000000000     | 20000.00   | 20000.00   |
| bcf5205a-102a-4304-a4dc-8ca258f42de2 | ⑪    | 諸材料費          | variable_cost | 1           | 111111.00    | 111111.000000000000    | 111111.00  | 111111.00  |
| d568f8cb-fe09-4b76-906f-becdf276872d | ⑭    | 作業用衣料費        | fixed_cost    | 0           | null         | null                   | null       | null       |
| 4bed3e04-5f54-4ba8-976b-73c6ef093b9b | ⑰    | 荷造運賃手数料       | variable_cost | 0           | null         | null                   | null       | null       |
| 48bf2000-32ba-43ac-9ba0-2b23e6bbab3f | その他  | その他           | variable_cost | 0           | null         | null                   | null       | null       |
| 779ecb28-74a3-410a-a6f9-4d326f4bb702 | ⑬    | 動力光熱費         | fixed_cost    | 0           | null         | null                   | null       | null       |
| 3eeedc10-b27f-4399-9ede-8b02c5db9d80 | ⑫    | 修繕費           | fixed_cost    | 0           | null         | null                   | null       | null       |
| 79395e63-9b1f-4959-9d09-82cbdfc30161 | ④    | 租税公課          | fixed_cost    | 0           | null         | null                   | null       | null       |
| d08f3208-9686-4a1f-b2a6-6eaff5832af3 | ⑲    | 利子割引料         | fixed_cost    | 0           | null         | null                   | null       | null       |
| 736ed430-ce42-41d2-9133-ef6452fc4fc9 | ⑱    | 雇人費           | variable_cost | 0           | null         | null                   | null       | null       |
| 905a949a-15af-469b-be94-0f57f53fac85 | ⑥    | 素畜費           | variable_cost | 0           | null         | null                   | null       | null       |
| 2d8d104f-3a2c-4d35-9203-0fb08e7e3413 | ㉑    | 土地改良費         | fixed_cost    | 0           | null         | null                   | null       | null       |
| b8aca34b-3300-4dff-9800-5378a604ad9d | ⑯    | 減価償却費         | fixed_cost    | 0           | null         | null                   | null       | null       |
| 38394323-c195-4e4b-b77d-77f27d7f0381 | ③    | 雑収入           | income        | 0           | null         | null                   | null       | null       |
| f41de9d2-1b31-44e6-94e7-c5cd023cca33 | ⑨    | 農具費           | fixed_cost    | 0           | null         | null                   | null       | null       |
| 0383702a-b348-4cbe-a24e-ffa1fb5922f8 | ⑩    | 農薬衛生費         | variable_cost | 0           | null         | null                   | null       | null       |
| 4e649fac-9122-47d3-98a3-8105d0abc5b5 | ㉒    | 共販諸掛料         | variable_cost | 0           | null         | null                   | null       | null       |
| 20969ab6-fd05-4a36-9128-de8242d2a964 | ②    | 家事消費金額・事業消費金額 | income        | 0           | null         | null                   | null       | null       |
| 2b23b7c6-ae39-453e-9e12-49bb616ae580 | ⑮    | 農業共済掛金        | fixed_cost    | 0           | null         | null                   | null       | null       |

 -- 9.2 月別の会計データ量
 | month                  | company_count | report_count | accounting_record_count | total_income | total_expense |
| ---------------------- | ------------- | ------------ | ----------------------- | ------------ | ------------- |
| 2025-11-01 00:00:00+00 | 1             | 1            | 1                       | 200000.00    | 0             |
| 2025-09-01 00:00:00+00 | 1             | 5            | 4                       | 0            | 1121111.00    |
| 2025-06-01 00:00:00+00 | 1             | 2            | 3                       | 400000.00    | 3520000.00    |
| 2025-05-01 00:00:00+00 | 1             | 2            | 3                       | 400000.00    | 2734234.00    |

========================================================
  10. 将来のスケーラビリティ分析

  10.1がない？

    -- 10.2 ストレージ予測
[ERROR:  42703: column "tablename" does not exist
LINE 3:       tablename,
              ^]

11.database の SQLは以下です。
-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.accounting_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['income'::character varying, 'expense'::character varying, 'both'::character varying]::text[])),
  category character varying,
  description text,
  is_active boolean DEFAULT true,
  sort_order integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  cost_type text CHECK (cost_type = ANY (ARRAY['income'::text, 'fixed_cost'::text, 'variable_cost'::text])),
  CONSTRAINT accounting_items_pkey PRIMARY KEY (id)
);
CREATE TABLE public.accounting_recommendations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  company_id uuid,
  work_type character varying NOT NULL,
  accounting_item_id uuid,
  confidence_score numeric,
  usage_count integer DEFAULT 1,
  avg_amount numeric,
  last_used_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT accounting_recommendations_pkey PRIMARY KEY (id),
  CONSTRAINT accounting_recommendations_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT accounting_recommendations_accounting_item_id_fkey FOREIGN KEY (accounting_item_id) REFERENCES public.accounting_items(id)
);
CREATE TABLE public.address_geocoding_cache (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  query text NOT NULL,
  query_type text NOT NULL,
  latitude numeric,
  longitude numeric,
  formatted_address text,
  prefecture text,
  city text,
  source text NOT NULL,
  confidence_score numeric,
  expires_at timestamp with time zone DEFAULT (now() + '30 days'::interval),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT address_geocoding_cache_pkey PRIMARY KEY (id)
);
CREATE TABLE public.companies (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  contact_email text NOT NULL UNIQUE,
  phone text,
  address text,
  is_active boolean NOT NULL DEFAULT true,
  settings jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT companies_pkey PRIMARY KEY (id)
);
CREATE TABLE public.companies_backup_20240121 (
  id uuid,
  name text,
  contact_email text,
  phone text,
  address text,
  is_active boolean,
  settings jsonb,
  created_at timestamp with time zone,
  updated_at timestamp with time zone
);
CREATE TABLE public.demo_growing_tasks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  company_id uuid NOT NULL DEFAULT 'a1111111-1111-1111-1111-111111111111'::uuid,
  vegetable_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  task_type text NOT NULL,
  priority text NOT NULL DEFAULT 'medium'::text CHECK (priority = ANY (ARRAY['high'::text, 'medium'::text, 'low'::text])),
  status text NOT NULL DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'completed'::text, 'cancelled'::text])),
  start_date date NOT NULL,
  end_date date NOT NULL,
  estimated_hours numeric,
  actual_hours numeric,
  progress integer NOT NULL DEFAULT 0 CHECK (progress >= 0 AND progress <= 100),
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT demo_growing_tasks_pkey PRIMARY KEY (id),
  CONSTRAINT demo_growing_tasks_vegetable_id_fkey FOREIGN KEY (vegetable_id) REFERENCES public.demo_vegetables(id)
);
CREATE TABLE public.demo_vegetables (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  company_id uuid NOT NULL DEFAULT 'a1111111-1111-1111-1111-111111111111'::uuid,
  name text NOT NULL,
  variety_name text,
  plot_name text,
  area_size numeric,
  plant_count integer,
  planting_date date NOT NULL,
  expected_harvest_start date,
  expected_harvest_end date,
  actual_harvest_start date,
  actual_harvest_end date,
  status text NOT NULL DEFAULT 'planning'::text CHECK (status = ANY (ARRAY['planning'::text, 'growing'::text, 'harvesting'::text, 'completed'::text])),
  notes text,
  deleted_at timestamp with time zone,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  spatial_data jsonb,
  polygon_coordinates jsonb,
  plot_center_lat numeric,
  plot_center_lng numeric,
  polygon_color character varying DEFAULT '#22c55e'::character varying,
  has_spatial_data boolean DEFAULT ((spatial_data IS NOT NULL) OR (polygon_coordinates IS NOT NULL)),
  farm_area_data jsonb,
  CONSTRAINT demo_vegetables_pkey PRIMARY KEY (id)
);
CREATE TABLE public.demo_work_report_accounting (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  work_report_id uuid,
  accounting_item_id uuid,
  amount numeric NOT NULL,
  cost_type text CHECK (cost_type = ANY (ARRAY['income'::text, 'variable_cost'::text, 'fixed_cost'::text])),
  item_name text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT demo_work_report_accounting_pkey PRIMARY KEY (id),
  CONSTRAINT demo_work_report_accounting_work_report_id_fkey FOREIGN KEY (work_report_id) REFERENCES public.demo_work_reports(id)
);
CREATE TABLE public.demo_work_reports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  company_id uuid NOT NULL DEFAULT 'a1111111-1111-1111-1111-111111111111'::uuid,
  vegetable_id uuid NOT NULL,
  growing_task_id uuid,
  work_type text NOT NULL,
  description text,
  work_date date NOT NULL,
  start_time time without time zone,
  end_time time without time zone,
  duration_hours numeric,
  weather text,
  temperature numeric,
  harvest_amount numeric,
  harvest_unit text,
  harvest_quality text,
  worker_count integer DEFAULT 1,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  expected_revenue numeric,
  work_amount numeric,
  work_unit text,
  fertilizer_type text,
  fertilizer_amount numeric,
  fertilizer_unit text,
  CONSTRAINT demo_work_reports_pkey PRIMARY KEY (id),
  CONSTRAINT demo_work_reports_vegetable_id_fkey FOREIGN KEY (vegetable_id) REFERENCES public.demo_vegetables(id),
  CONSTRAINT demo_work_reports_growing_task_id_fkey FOREIGN KEY (growing_task_id) REFERENCES public.demo_growing_tasks(id)
);
CREATE TABLE public.growing_tasks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  company_id uuid NOT NULL,
  vegetable_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  task_type text NOT NULL,
  priority text NOT NULL DEFAULT 'medium'::text CHECK (priority = ANY (ARRAY['high'::text, 'medium'::text, 'low'::text])),
  status text NOT NULL DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'completed'::text, 'cancelled'::text])),
  start_date date NOT NULL,
  end_date date NOT NULL,
  estimated_hours numeric,
  actual_hours numeric,
  progress integer NOT NULL DEFAULT 0 CHECK (progress >= 0 AND progress <= 100),
  notes text,
  deleted_at timestamp with time zone,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  assigned_to uuid,
  CONSTRAINT growing_tasks_pkey PRIMARY KEY (id),
  CONSTRAINT growing_tasks_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id),
  CONSTRAINT growing_tasks_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT growing_tasks_vegetable_id_fkey FOREIGN KEY (vegetable_id) REFERENCES public.vegetables(id),
  CONSTRAINT growing_tasks_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.photos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  vegetable_id uuid NOT NULL,
  storage_path text NOT NULL,
  original_filename text NOT NULL,
  file_size integer,
  mime_type text NOT NULL,
  taken_at timestamp with time zone NOT NULL DEFAULT now(),
  description text,
  tags ARRAY DEFAULT '{}'::text[],
  is_primary boolean DEFAULT false,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT photos_pkey PRIMARY KEY (id),
  CONSTRAINT photos_vegetable_id_fkey FOREIGN KEY (vegetable_id) REFERENCES public.vegetables(id),
  CONSTRAINT photos_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.spatial_ref_sys (
  srid integer NOT NULL CHECK (srid > 0 AND srid <= 998999),
  auth_name character varying,
  auth_srid integer,
  srtext character varying,
  proj4text character varying,
  CONSTRAINT spatial_ref_sys_pkey PRIMARY KEY (srid)
);
CREATE TABLE public.users (
  id uuid NOT NULL,
  company_id uuid NOT NULL,
  email text NOT NULL UNIQUE,
  full_name text,
  is_active boolean NOT NULL DEFAULT true,
  last_login_at timestamp with time zone,
  settings jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id)
);
CREATE TABLE public.users_backup_20240121 (
  id uuid,
  company_id uuid,
  email text,
  full_name text,
  is_active boolean,
  last_login_at timestamp with time zone,
  settings jsonb,
  created_at timestamp with time zone,
  updated_at timestamp with time zone
);
CREATE TABLE public.vegetable_deletion_audit (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  deleted_vegetable_id uuid NOT NULL,
  vegetable_snapshot jsonb NOT NULL,
  related_data_count jsonb NOT NULL,
  deletion_reason text NOT NULL,
  deleted_by uuid,
  deleted_at timestamp with time zone DEFAULT now(),
  confirmation_details jsonb,
  business_impact jsonb,
  CONSTRAINT vegetable_deletion_audit_pkey PRIMARY KEY (id)
);
CREATE TABLE public.vegetable_varieties (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  variety text,
  category text NOT NULL,
  standard_growth_days integer,
  standard_tasks jsonb DEFAULT '[]'::jsonb,
  planting_season text,
  harvest_season text,
  optimal_temperature_min integer,
  optimal_temperature_max integer,
  water_requirement text,
  sunlight_requirement text,
  soil_ph_min numeric,
  soil_ph_max numeric,
  notes text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT vegetable_varieties_pkey PRIMARY KEY (id)
);
CREATE TABLE public.vegetables (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  company_id uuid NOT NULL,
  name text NOT NULL,
  variety_name text,
  plot_name text,
  area_size numeric,
  plant_count integer,
  planting_date date NOT NULL,
  expected_harvest_start date,
  expected_harvest_end date,
  actual_harvest_start date,
  actual_harvest_end date,
  status text NOT NULL DEFAULT 'planning'::text CHECK (status = ANY (ARRAY['planning'::text, 'growing'::text, 'harvesting'::text, 'completed'::text])),
  notes text,
  deleted_at timestamp with time zone,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  spatial_data jsonb,
  polygon_coordinates jsonb,
  plot_center_lat numeric,
  plot_center_lng numeric,
  polygon_color character varying DEFAULT '#22c55e'::character varying,
  CONSTRAINT vegetables_pkey PRIMARY KEY (id),
  CONSTRAINT vegetables_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT vegetables_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.work_report_accounting (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  work_report_id uuid,
  accounting_item_id uuid,
  amount numeric NOT NULL DEFAULT 0,
  custom_item_name character varying,
  notes text,
  is_ai_recommended boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT work_report_accounting_pkey PRIMARY KEY (id),
  CONSTRAINT work_report_accounting_work_report_id_fkey FOREIGN KEY (work_report_id) REFERENCES public.work_reports(id),
  CONSTRAINT work_report_accounting_accounting_item_id_fkey FOREIGN KEY (accounting_item_id) REFERENCES public.accounting_items(id)
);
CREATE TABLE public.work_reports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  company_id uuid NOT NULL,
  vegetable_id uuid NOT NULL,
  growing_task_id uuid,
  work_type text NOT NULL,
  description text,
  work_date date NOT NULL,
  start_time time without time zone,
  end_time time without time zone,
  duration_hours numeric,
  weather text,
  temperature numeric,
  harvest_amount numeric,
  harvest_unit text,
  harvest_quality text,
  worker_count integer DEFAULT 1,
  notes text,
  deleted_at timestamp with time zone,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  expected_price numeric,
  humidity integer CHECK (humidity >= 0 AND humidity <= 100),
  soil_ph numeric CHECK (soil_ph >= 3.0 AND soil_ph <= 10.0),
  soil_ec numeric,
  phosphorus_absorption integer,
  cec numeric,
  exchangeable_calcium integer,
  exchangeable_magnesium integer,
  exchangeable_potassium integer,
  base_saturation numeric CHECK (base_saturation >= 0::numeric AND base_saturation <= 100::numeric),
  calcium_magnesium_ratio numeric,
  magnesium_potassium_ratio numeric,
  available_phosphorus numeric,
  available_silica numeric,
  humus_content numeric,
  ammonium_nitrogen numeric,
  nitrate_nitrogen numeric,
  manganese numeric,
  boron numeric,
  free_iron_oxide numeric,
  soil_notes text,
  work_duration integer,
  photos ARRAY,
  income_items jsonb,
  expense_items jsonb,
  income_total numeric,
  expense_total numeric,
  net_income numeric,
  work_amount numeric,
  work_unit text,
  fertilizer_type text,
  fertilizer_amount numeric,
  fertilizer_unit text,
  expected_revenue numeric,
  CONSTRAINT work_reports_pkey PRIMARY KEY (id),
  CONSTRAINT work_reports_company_id_fkey FOREIGN KEY (company_id) REFERENCES public.companies(id),
  CONSTRAINT work_reports_vegetable_id_fkey FOREIGN KEY (vegetable_id) REFERENCES public.vegetables(id),
  CONSTRAINT work_reports_growing_task_id_fkey FOREIGN KEY (growing_task_id) REFERENCES public.growing_tasks(id),
  CONSTRAINT work_reports_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);

====================================================================
 追加: 実際のデータサンプル（実行計画用）

 -- 実際のcompany_idを取得して使用
| description       | company_id                           |
| ----------------- | ------------------------------------ |
| Sample Company ID | 4cb3e254-9d73-4d67-b9ae-433bf249fe38 |

-- 取得したcompany_idを使って実際のクエリパフォーマンスを測定
| QUERY PLAN                                                                                                                        |
| --------------------------------------------------------------------------------------------------------------------------------- |
| Aggregate  (cost=2.46..2.47 rows=1 width=40) (actual time=0.066..0.068 rows=1 loops=1)                                            |
|   Buffers: shared hit=2                                                                                                           |
|   ->  Hash Join  (cost=1.25..2.40 rows=11 width=5) (actual time=0.050..0.055 rows=11 loops=1)                                     |
|         Hash Cond: (wra.work_report_id = wr.id)                                                                                   |
|         Buffers: shared hit=2                                                                                                     |
|         ->  Seq Scan on work_report_accounting wra  (cost=0.00..1.11 rows=11 width=21) (actual time=0.014..0.015 rows=11 loops=1) |
|               Buffers: shared hit=1                                                                                               |
|         ->  Hash  (cost=1.12..1.12 rows=10 width=16) (actual time=0.024..0.024 rows=10 loops=1)                                   |
|               Buckets: 1024  Batches: 1  Memory Usage: 9kB                                                                        |
|               Buffers: shared hit=1                                                                                               |
|               ->  Seq Scan on work_reports wr  (cost=0.00..1.12 rows=10 width=16) (actual time=0.009..0.011 rows=10 loops=1)      |
|                     Filter: (company_id = '4cb3e254-9d73-4d67-b9ae-433bf249fe38'::uuid)                                           |
|                     Buffers: shared hit=1                                                                                         |
| Planning:                                                                                                                         |
|   Buffers: shared hit=358                                                                                                         |
| Planning Time: 2.812 ms                                                                                                           |
| Execution Time: 0.175 ms                                                                                                          |