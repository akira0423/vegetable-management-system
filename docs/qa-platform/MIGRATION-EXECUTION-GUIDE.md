# ğŸ“‹ å›ç­”æœ¬æ–‡åˆ†é›¢ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã‚¬ã‚¤ãƒ‰

## ğŸ¯ æ¦‚è¦
`20250928_qa_answer_contents_separation.sql`ã‚’å®Ÿè¡Œã—ã¦ã€å›ç­”æœ¬æ–‡ã‚’åˆ†é›¢ç®¡ç†ã™ã‚‹è¨­è¨ˆã«ç§»è¡Œã—ã¾ã™ã€‚

## âœ… å®Ÿè¡Œå¯èƒ½æ€§

### **ä¸€æ‹¬å®Ÿè¡Œ: å¯èƒ½ã§ã™**
ã“ã®SQLã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ãŸã‚ã€**Supabase SQL Editorã§ä¸€æ‹¬å®Ÿè¡Œå¯èƒ½**ã§ã™ï¼š

1. **å‰ææ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹**
   - `20250922_qa_platform_initial.sql`å®Ÿè¡Œæ¸ˆã¿
   - æ—¢å­˜ã®qa_answersãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨

2. **ç ´å£Šçš„å¤‰æ›´ãŒãªã„**
   - æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã‚‹
   - æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ã®ã¿
   - æ®µéšçš„ç§»è¡Œã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆ

3. **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½**
   - qa_answers.bodyã‚«ãƒ©ãƒ ã¯ä¿æŒ
   - ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã¯å¯é€†çš„

## ğŸ“Š æ•´åˆæ€§ç¢ºèª

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé–“ã®æ•´åˆæ€§

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | çŠ¶æ…‹ | æ›´æ–°å†…å®¹ |
|-------------|------|----------|
| **supabase-complete-schema.sql** | âœ… æ›´æ–°æ¸ˆã¿ | qa_answer_contentsãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©è¿½åŠ  |
| **api-specification.md** | âœ… æ›´æ–°æ¸ˆã¿ | å›ç­”æŠ•ç¨¿APIã«è£œè¶³è¿½åŠ  |
| **IMPLEMENTATION-STATUS.md** | âœ… æ›´æ–°æ¸ˆã¿ | 2025-09-28ã®ä½œæ¥­è¨˜éŒ²è¿½åŠ  |
| **implementation-plan.md** | ğŸ”„ å½±éŸ¿ãªã— | åŸºæœ¬è¨­è¨ˆã¨çŸ›ç›¾ãªã— |
| **user-journey-guide.md** | ğŸ”„ å½±éŸ¿ãªã— | UXå¤‰æ›´ãªã— |

### è¨­è¨ˆåŸå‰‡ã¨ã®æ•´åˆæ€§

âœ… **å®Œå…¨åˆ†é›¢è¨­è¨ˆã‚’ç¶­æŒ**
- æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ç‹¬ç«‹æ€§ä¿æŒ
- qa_ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§åå‰ç©ºé–“åˆ†é›¢

âœ… **æ®µéšçš„ç§»è¡Œã‚’è€ƒæ…®**
- qa_answers.bodyã‚’ä¸€æ™‚çš„ã«ä¿æŒ
- æ—¢å­˜APIã¨ã®äº’æ›æ€§ç¶­æŒå¯èƒ½

âœ… **RLSåˆ¶å¾¡ã®å¼·åŒ–**
- å›ç­”è€…ã¯è‡ªåˆ†ã®å›ç­”æœ¬æ–‡ã®ã¿é–²è¦§
- è³ªå•è€…ãƒ»PPVè³¼å…¥è€…ã¯å…¨å›ç­”é–²è¦§å¯èƒ½

## ğŸš€ å®Ÿè¡Œæ‰‹é †

### 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨ï¼‰
```sql
-- Supabase Dashboard > Database > Backups
-- æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ
```

### 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
```sql
-- Supabase SQL Editorã§ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
-- ãƒ•ã‚¡ã‚¤ãƒ«: supabase/migrations/20250928_qa_answer_contents_separation.sql
-- å…¨å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å®Ÿè¡Œ
```

### 3. å®Ÿè¡Œç¢ºèª
```sql
-- å®Ÿè¡Œå¾Œã®ç¢ºèªã‚¯ã‚¨ãƒª
SELECT
    COUNT(*) as total_answers,
    COUNT(DISTINCT ac.answer_id) as migrated_contents,
    COUNT(*) - COUNT(DISTINCT ac.answer_id) as missing_contents
FROM qa_answers a
LEFT JOIN qa_answer_contents ac ON ac.answer_id = a.id;

-- RLSãƒãƒªã‚·ãƒ¼ç¢ºèª
SELECT policyname FROM pg_policies
WHERE tablename = 'qa_answer_contents'
ORDER BY policyname;
```

## ğŸ“ å®Ÿè¡Œå¾Œã®å¯¾å¿œ

### APIã®æ›´æ–°ãŒå¿…è¦ãªç®‡æ‰€

#### 1. å›ç­”æŠ•ç¨¿ (`POST /qa/answers`)
```typescript
// å¤‰æ›´å‰
await supabase.from('qa_answers').insert({
  body: requestBody.body,
  // ...
});

// å¤‰æ›´å¾Œ
const { data: answer } = await supabase.from('qa_answers').insert({
  body_preview: requestBody.body.substring(0, 200),
  // ...
});

await supabase.from('qa_answer_contents').insert({
  answer_id: answer.id,
  body: requestBody.body
});
```

#### 2. å›ç­”å–å¾—ï¼ˆæ¨©é™ã«å¿œã˜ãŸå‡¦ç†ï¼‰
```typescript
// ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯å…¨å“¡å–å¾—å¯èƒ½
const { data: answers } = await supabase
  .from('qa_answers')
  .select('*');

// æœ¬æ–‡ã¯æ¨©é™è€…ã®ã¿
const { data: contents } = await supabase
  .from('qa_answer_contents')
  .select('*')
  .in('answer_id', answerIds);
```

## âš ï¸ æ³¨æ„äº‹é …

1. **é–‹ç™ºç’°å¢ƒã§ã®å‹•ä½œç¢ºèª**
   - é–‹ç™ºç’°å¢ƒã§å…ˆã«å®Ÿè¡Œã‚’æ¨å¥¨
   - RLSãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ç¢ºèª

2. **æ®µéšçš„ãªç§»è¡Œ**
   - å½“é¢ã¯qa_answers.bodyã‚‚ç¶­æŒ
   - APIã¨UIã®æ›´æ–°å¾Œã«å‰Šé™¤äºˆå®š

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**
   - JOINãŒå¢—ãˆã‚‹ãŸã‚åˆæœŸã¯ç›£è¦–å¼·åŒ–
   - å¿…è¦ã«å¿œã˜ã¦ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 

## ğŸ” å½±éŸ¿ç¯„å›²

### å½±éŸ¿ã‚’å—ã‘ã‚‹æ©Ÿèƒ½
- âœ… å›ç­”æŠ•ç¨¿æ©Ÿèƒ½
- âœ… å›ç­”é–²è¦§æ©Ÿèƒ½
- âœ… PPVè³¼å…¥å¾Œã®å…¨æ–‡è¡¨ç¤º

### å½±éŸ¿ã‚’å—ã‘ãªã„æ©Ÿèƒ½
- âŒ è³ªå•æŠ•ç¨¿ãƒ»é–²è¦§
- âŒ æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- âŒ æ±ºæ¸ˆå‡¦ç†

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š**
   - å›ç­”æœ¬æ–‡ã®å³æ ¼ãªå¯è¦–æ€§åˆ¶å¾¡
   - æ„å›³ã—ãªã„æƒ…å ±æ¼æ´©ã®é˜²æ­¢

2. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**
   - æœ¬æ–‡ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢
   - å°†æ¥çš„ãªæœ€é©åŒ–ãŒå®¹æ˜“

3. **ä¿å®ˆæ€§å‘ä¸Š**
   - RLSãƒ­ã‚¸ãƒƒã‚¯ã®æ˜ç¢ºåŒ–
   - ãƒ†ãƒ¼ãƒ–ãƒ«è²¬å‹™ã®å˜ä¸€åŒ–