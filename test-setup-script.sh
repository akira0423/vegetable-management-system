#!/bin/bash

# Test Setup and Execution Script
# é‡èœç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ç”¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

set -e

echo "ğŸŒ± é‡èœç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–‹å§‹..."

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
echo "ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
npm install

# TypeScriptå‹ãƒã‚§ãƒƒã‚¯
echo "ğŸ” TypeScriptå‹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­..."
npx tsc --noEmit

# ESLintå®Ÿè¡Œ
echo "ğŸ“ ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­..."
npm run lint

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
echo "ğŸ§ª ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œä¸­..."

# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
echo "  â†’ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ..."
npm test -- --testPathPattern="/(components|lib)/" --verbose

# APIãƒ†ã‚¹ãƒˆ  
echo "  â†’ APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ..."
npm test -- --testPathPattern="/api/" --verbose

# çµ±åˆãƒ†ã‚¹ãƒˆ
echo "  â†’ çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ..."
npm test -- --testPathPattern="/integration/" --verbose

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
echo "ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­..."
npm run test:coverage

echo "âœ… ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼"
echo ""
echo "ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ: coverage/index.html"
echo "ğŸ“‹ ãƒ†ã‚¹ãƒˆçµæœã®è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"